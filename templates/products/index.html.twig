{% extends 'base.html.twig' %}

{% block title %}Product Store
{% endblock %}

{% block body %}
        <div>
            <div id="days"></div>
                <div class="d-flex">
                    <div id="hour"></div>
                    <div id="min"></div>
                    <div id="sec"></div>
                </div>
            </div>
            <div class="countdown"></div>
        </div>
	<div class="container my-5">
		<div class="row">
			<div class="col-md-3">
				<div class="card">
					<div class="card-body">
						<h5 class="card-title">Filter by color</h5>
						<form>
							<div class="form-group">
								<select class="form-control" id="color" name="color" onchange="this.form.submit()">
									<option value="">All</option>
									{% for color in colors %}
										<option value="{{ color.id }}" {% if selectedColor == color.id %} selected {% endif %}>{{ color.name }}</option>
									{% endfor %}
								</select>
							</div>
							<h5 class="card-title">Filter by category</h5>
							<div class="form-group">
								<select class="form-control" id="category" name="category" onchange="this.form.submit()">
									<option value="">All</option>
									{% for category in categories %}
										<option value="{{ category.id }}" {% if selectedCategory == category.id %} selected {% endif %}>{{ category.name }}</option>
									{% endfor %}
								</select>
							</div>
							<h5 class="card-title">Sort by</h5>
							<div class="form-group">
								<select class="form-control" id="sort" name="sort" onchange="this.form.submit()">
									<option value="">Default</option>
									<option value="name_asc" {% if sort == 'name_asc' %} selected {% endif %}>Name A-Z</option>
									<option value="name_desc" {% if sort == 'name_desc' %} selected {% endif %}>Name Z-A</option>
									<option value="date_asc" {% if sort == 'date_asc' %} selected {% endif %}>Date Oldest First</option>
									<option value="date_desc" {% if sort == 'date_desc' %} selected {% endif %}>Date Newest First</option>
								</select>
							</div>
						</form>

					</div>
				</div>
			</div>
			<div class="col-md-9">
				<h1 class="mb-4">Our Products</h1>
                {% include "partials/_search.html.twig" %}
				{% if products|length > 0 %}
					<div class="row">

						{% for product in products %}
							{% include "partials/_cardProduct.html.twig" %}
						{% endfor %}
					</div>
					{% include "partials/_pagination.html.twig" with {
                    'route': 'store',
                    'parameters': {},
                    'page': currentPage,
                    'pages': totalPages
                } %}
				{% else %}
					<p>No products... yet</p>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	{{encore_entry_script_tags('search')}}
    <script>
        // update chrono
        function chrono() {
            const divDays = document.querySelector('#days');
            const divHours = document.querySelector('#hour');
            const divMin = document.querySelector('#min');
            const divSec = document.querySelector('#sec');
            // count endDate
            function compte() {
                var actualDatetime = new Date();
                var endDate = new Date("October 18, 2024 00:00:00");
                var totalSecondes = (endDate - actualDatetime) / 1000;
                // if timer ends
                if (totalSecondes < 0) {
                    divCount.innerHTML = "fin";
                    return;
                }
                // values
                var days = Math.floor(totalSecondes / (60 * 60 * 24));
                var hours = Math.floor((totalSecondes - (days * 60 * 60 * 24)) / (60 * 60));
                var minutes = Math.floor((totalSecondes - ((days * 60 * 60 * 24 + hours * 60 * 60))) / 60);
                var secondes = Math.floor(totalSecondes - ((days * 60 * 60 * 24 + hours * 60 * 60 + minutes * 60)));
                // display
                divDays.innerHTML = days + " days";
                divHours.innerHTML = hours + ":";
                divMin.innerHTML = minutes + ":";
                divSec.innerHTML = secondes;
                var actualisation = setTimeout(compte, 1000);
            }
            compte();
        }
        chrono();
    </script>
{% endblock %}