{% extends 'base.html.twig' %}

{% block title %}Product Store
{% endblock %}

{% block body %}
        <div>
            <div id="days"></div>
                <div class="d-flex">
                    <div id="hour"></div>
                    <div id="min"></div>
                    <div id="sec"></div>
                </div>
            </div>
            <div class="countdown"></div>
        </div>
<div class="slide bg-background min-h-full">
	<div class="container mx-auto my-5 px-4 min-h-full">
	<div class="flex flex-wrap -mx-4 min-h-full">
			<!-- Filter Sidebar -->
			<div class="w-full md:w-1/4 px-4 mb-4 min-h-full">
				<div class="bg-white border border-gray-200 rounded-lg shadow-md p-4 h-fit sticky top-4 z-10">
					<h5 class="text-lg font-semibold mb-4">Filter by color</h5>
					<form>
						<div class="mb-4">
							<select class="form-select block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="color" name="color" onchange="this.form.submit()">
								<option value="">All</option>
								{% for color in colors %}
									<option value="{{ color.id }}" {% if selectedColor == color.id %} selected {% endif %}>{{ color.name }}</option>
								{% endfor %}
							</select>
						</div>
						<h5 class="text-lg font-semibold mb-4">Filter by category</h5>
						<div class="mb-4">
							<select class="form-select block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="category" name="category" onchange="this.form.submit()">
								<option value="">All</option>
								{% for category in categories %}
									<option value="{{ category.id }}" {% if selectedCategory == category.id %} selected {% endif %}>{{ category.name }}</option>
								{% endfor %}
							</select>
						</div>
						<h5 class="text-lg font-semibold mb-4">Sort by</h5>
						<div class="mb-4">
							<select class="form-select block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" id="sort" name="sort" onchange="this.form.submit()">
								<option value="">Default</option>
								<option value="name_asc" {% if sort == 'name_asc' %} selected {% endif %}>Name A-Z</option>
								<option value="name_desc" {% if sort == 'name_desc' %} selected {% endif %}>Name Z-A</option>
								<option value="date_asc" {% if sort == 'date_asc' %} selected {% endif %}>Date Oldest First</option>
								<option value="date_desc" {% if sort == 'date_desc' %} selected {% endif %}>Date Newest First</option>
							</select>
						</div>
					</form>
				</div>
			</div>

			<!-- Products Grid -->
			<div class="w-full md:w-3/4 px-4">
				<div class="flex justify-between">
					<h2 class="text-3xl font-bold mb-4 text-tertiary-dark">Our Products</h2>
					{% include "partials/_search.html.twig" %}
				</div>
				{% if products|length > 0 %}
					<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
						{% for product in products %}
							{% include "partials/_cardProduct.html.twig" %}
						{% endfor %}
					</div>
					{% include "partials/_pagination.html.twig" with {
						'route': 'store',
						'parameters': {},
						'page': currentPage,
						'pages': totalPages
					} %}
				{% else %}
					<p>No products... yet</p>
				{% endif %}
			</div>
		</div>
	</div>
</div>

{% endblock %}

{% block javascripts %}
	{{encore_entry_script_tags('search')}}
    <script>
        // update chrono
        function chrono() {
            const divDays = document.querySelector('#days');
            const divHours = document.querySelector('#hour');
            const divMin = document.querySelector('#min');
            const divSec = document.querySelector('#sec');
            // count endDate
            function compte() {
                var actualDatetime = new Date();
                var endDate = new Date("October 18, 2024 00:00:00");
                var totalSecondes = (endDate - actualDatetime) / 1000;
                // if timer ends
                if (totalSecondes < 0) {
                    divCount.innerHTML = "fin";
                    return;
                }
                // values
                var days = Math.floor(totalSecondes / (60 * 60 * 24));
                var hours = Math.floor((totalSecondes - (days * 60 * 60 * 24)) / (60 * 60));
                var minutes = Math.floor((totalSecondes - ((days * 60 * 60 * 24 + hours * 60 * 60))) / 60);
                var secondes = Math.floor(totalSecondes - ((days * 60 * 60 * 24 + hours * 60 * 60 + minutes * 60)));
                // display
                divDays.innerHTML = days + " days";
                divHours.innerHTML = hours + ":";
                divMin.innerHTML = minutes + ":";
                divSec.innerHTML = secondes;
                var actualisation = setTimeout(compte, 1000);
            }
            compte();
        }
        chrono();
    </script>
{% endblock %}