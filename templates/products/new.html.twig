{% extends "base.html.twig" %}

{% block title %}New Product{% endblock %}

{% form_theme myForm _self %}

{% block body %}
    <div class="container mt-4">
        <h1>New Product</h1>

        {{ form_start(myForm) }}
            {{ form_row(myForm.reference) }}
            {{ form_row(myForm.name) }}
            {{ form_row(myForm.description) }}
            {{ form_row(myForm.price) }}
            {{ form_row(myForm.color) }}

            <div id="product-variants" data-prototype="{{ form_widget(myForm.productVariants.vars.prototype) | e('html_attr') }}">
                {% for child in myForm.productVariants %}
                    <div class="form-row mb-3">
                        {{ form_widget(child) }}
                    </div>
                {% endfor %}
            </div>

            <button type="button" id="add-variant" class="btn btn-primary mt-3">Add Variant</button>
            <button type="submit" class="btn btn-primary mt-3">Submit</button>
        {{ form_end(myForm) }}
    </div>
{% endblock %}

{% block form_row %}
    <div class="form-group mt-2">
        <div class="row">
            <div class="col-6">
                {{ form_label(form) }}
            </div>
            <div class="col-6">
                {{ form_widget(form) }}
                {{ form_errors(form) }}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.querySelector('#product-variants');
        const addButton = document.querySelector('#add-variant');
        const prototype = container.dataset.prototype;
        let index = container.querySelectorAll('.form-row').length;

        addButton.addEventListener('click', () => {
            const newElement = document.createElement('div');
            newElement.classList.add('form-row', 'mb-3');
            const html = prototype.replace(/__name__/g, index);
            newElement.innerHTML = html + '<button type="button" class="btn btn-danger remove-variant">-</button>';
            index++;
            container.appendChild(newElement);
        });

        container.addEventListener('click', (event) => {
            if (event.target.classList.contains('remove-variant')) {
                event.target.closest('.form-row').remove();
            }
        });
    });
    </script>
{% endblock %}
