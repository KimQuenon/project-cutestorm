{% extends 'base.html.twig' %}

{% block title %}Order Details{% endblock %}

{% block body %}
<div class="container mt-5">
    {% if order.isPayed %}
        <span class="badge rounded-pill bg-success">Paid</span>
    {% else %}
        <span class="badge rounded-pill bg-danger">Unpaid</span>
    {% endif %}
    <h1>Order Details</h1>
    <a href="{{ path('order_pdf', { reference: order.reference }) }}" class="btn btn-primary">Download PDF</a>
    <h2>Order Reference: {{ order.reference }}</h2>
    <p><strong>Delivery Method:</strong> {{ order.delivery.name }}</p>
    <p><strong>Delivery Cost:</strong> {{ order.delivery.price|number_format(2, ',', '.') }} $</p>
    <p><strong>Delivery Time:</strong> {{ order.delivery.deliveryTime }}</p>
    <h3>Items:</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Product</th>
                <th>Size</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            {% for orderItem in order.orderItems %}
            <tr>
                <td>{{ orderItem.productVariant.product.name }}</td>
                <td>{{ orderItem.productVariant.size }}</td>
                <td>{{ orderItem.quantity }}</td>
                <td>{{ orderItem.productVariant.product.price|number_format(2, ',', '.') }} $</td>
                <td>{{ (orderItem.productVariant.product.price * orderItem.quantity)|number_format(2, ',', '.') }} $</td>
            </tr>
            {% endfor %}
            <tr>
                <td colspan="4" class="text-end"><strong>Subtotal:</strong></td>
                <td>{{ (order.totalPrice - order.delivery.price)|number_format(2, ',', '.') }} $</td>
            </tr>
            <tr>
                <td colspan="4" class="text-end"><strong>Delivery:</strong></td>
                <td>{{ order.delivery.price|number_format(2, ',', '.') }} $</td>
            </tr>
            <tr>
                <td colspan="4" class="text-end"><strong>Total:</strong></td>
                <td>{{ order.totalPrice|number_format(2, ',', '.') }} $</td>
            </tr>
        </tbody>
    </table>
    {% if not order.isPayed %}
        <a href="{{ path('payment_stripe', { reference: order.reference }) }}" class="btn btn-success">Pay</a>
    {% endif %}
    <a href="{{ path('orders_index') }}" class="btn btn-secondary">Back to Orders</a>
</div>
{% endblock %}
